const registro=[];const PRESUPUESTO=5e6;document.getElementById("totalPresupuesto").innerHTML=convertirAPesos(PRESUPUESTO);document.getElementById("presupuestoDisponible").innerHTML=convertirAPesos(PRESUPUESTO);let barraPresupuestoDisponible=document.getElementById("barraPresupuestoDisponible");let barraTotalGastado=document.getElementById("barraTotalGastado");barraPresupuestoDisponible.innerHTML=`<div class="progress" role="progressbar" aria-label="Success example" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
  <div class="progress-bar bg-success" style="width:100%">100%</div>
</div>`;barraTotalGastado.innerHTML=`<div class="progress" role="progressbar" aria-label="Danger example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
  <div class="progress-bar bg-danger" style="width: 20%">0%</div>
</div>`;function agregarItems(formulario){let nuevosProductos=document.forms[formulario];let nuevoProducto=[];for(const producto of nuevosProductos.elements){if(producto.id==="nombreItem"){if(producto.value.trim().length>0){nuevoProducto.push(producto.value)}else{throw new Error("El producto debe estar lleno");return}}else if(producto.id==="valorItem"){let valor=parseInt(producto.value.replace(/[^\d]/g,""));if(valor>0){let totalGastado=document.getElementById("totalGastadoPresupuesto").innerText;TotalGastado=parseInt(totalGastado.replace(/[^\d]/g,""));let control=parseInt(PRESUPUESTO-TotalGastado,10);if(control>=valor){nuevoProducto.push(valor);document.getElementById("nombreItem").value="";document.getElementById("nombreItem").focus();document.getElementById("valorItem").value=0}else{let valorAGastar=convertirAPesos(control);document.getElementById("valorItem").focus();document.getElementById("valorItem").value=valorAGastar;throw new Error(`No puedes gastarte mas de ${valorAGastar}`)}}else{throw new Error("El valor del producto debe ser mayor a cero")}}}registro.push(new Gastos(nuevoProducto[0],nuevoProducto[1]));let gastosRealizados=gastoTotal(registro);document.getElementById("totalGastadoPresupuesto").innerHTML=convertirAPesos(gastosRealizados);document.getElementById("presupuestoDisponible").innerHTML=convertirAPesos(presupuestoDisponible(gastosRealizados));calculoPorcentajeDisponible();calculoPorcentajeGastado();listaProductos(registro)}function gastoTotal(parametro){let costoTotal=0;for(let index=0;index<parametro.length;index++){const element=parametro[index];costoTotal=parseInt(element["_costoProducto"])+costoTotal}return costoTotal}function presupuestoDisponible(parametro){let totalDisponible=PRESUPUESTO-parametro;return totalDisponible}function listaProductos(datosProductos){let producto=[];let tbl=`<table class="table">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Item Producto</th>
                    <th scope="col">Cuanto Costo?</th>
                    <th scope="col">Presupuesto Restante</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>`;for(let index=0;index<datosProductos.length;index++){tbl+=`<tr class="${styleRow(index)}">
                    <th scope="row">1</th>
                    <td>${datosProductos[index]["_nombreProducto"]}</td>
                    <td>${convertirAPesos(datosProductos[index]["_costoProducto"])}</td>
                    <td>@mdo</td>
                    <td><i class="bi bi-trash" id='${datosProductos[index]["_idProducto"]}' onclick = 'borrarElemento(this.id)' style='cursor: pointer' ></i></td>
                  </tr>`}tbl+=`</tbody>
              </table>`;document.getElementById("tablaDeGastos").innerHTML=tbl}function borrarElemento(parametro){let idItem=parseInt(parametro);let idProductoEliminar=registro.find(registros=>registro._idProducto===idItem);let itemEliminar=registro.findIndex(registros=>registros._idProducto===idItem);registro.splice(itemEliminar,1);let gastosRealizados=gastoTotal(registro);document.getElementById("totalGastadoPresupuesto").innerHTML=convertirAPesos(gastosRealizados);document.getElementById("presupuestoDisponible").innerHTML=convertirAPesos(presupuestoDisponible(gastosRealizados));calculoPorcentajeDisponible();calculoPorcentajeGastado();listaProductos(registro)}function calculoPorcentajeDisponible(){let gastosTotales=gastoTotal(registro);let porcentajeGastado=parseInt(gastosTotales/PRESUPUESTO*10);let porcentajeDisponible=100-gastosTotales/PRESUPUESTO*100;barraPresupuestoDisponible.innerHTML=`<div class="progress" role="progressbar" aria-label="Success example" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
  <div class="progress-bar bg-success" style="width:${porcentajeDisponible}%">${porcentajeDisponible}%</div>
</div>`}function calculoPorcentajeGastado(){let gastosTotales=gastoTotal(registro);let porcentajeGastado=parseInt(gastosTotales/PRESUPUESTO*100);barraTotalGastado.innerHTML=`<div class="progress" role="progressbar" aria-label="Danger example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
    <div class="progress-bar bg-danger" style="width: ${porcentajeGastado}%">${porcentajeGastado}%</div>
    </div>`;return porcentajeGastado}function convertirAPesos(parametro){let valor=parseInt(parametro);let precio=valor.toLocaleString("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0});return precio}function styleRow(idRow){return parseInt(idRow)%2?"table-secondary":"table-ligth"}document.getElementById("valorItem").addEventListener("input",e=>{let valorSucio=e.target.value.replace(/[^\d]/g,"");if(valorSucio===""){e.target.value="";return}let valorNumerico=parseInt(valorSucio,10);let valorFormateado=convertirAPesos(valorNumerico);e.target.value=valorFormateado});const inputItems=document.getElementById("nombreItem");["blur","focus","change"].forEach(evento=>{inputItems.addEventListener(evento,e=>{let valor=e.target.value.trim();desactivarBtn(valor)})});const inputValor=document.getElementById("valorItem");["blur","focus","change"].forEach(evento=>{inputItems.addEventListener(evento,e=>{let valor=e.target.value.trim();desactivarBtn(valor)})});function desactivarBtn(e){if(e.trim().length>0){document.getElementById("registrarGasto").disabled=false}else{document.getElementById("registrarGasto").disabled=true}}